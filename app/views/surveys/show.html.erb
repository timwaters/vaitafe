<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
 integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
 crossorigin=""></script>

<main class="margin">
 
  <section class="section">
  <h2 class="title is-3">Survey</h2>

    <div class="block">
      <table class="table is-hoverable is-fullwidth ">
      <tbody>
        <tr><td>Surveyed At</td> <td><%= @survey.surveyed_at.to_fs(:short) if @survey.surveyed_at %></td> </tr>
        <tr><td>User</td> <td><%= @survey.user.username %></td> </tr>
        <tr><td>River</td> <td><%= @survey.river %></td></tr>
        <tr><td colspan="2">
          <% if @survey.lonlat && @survey.lonlat.coordinates %>
          <div id="map"></div>
          <% end %>
        </td></tr>
        <tr><td colspan="2"><%= @survey.subtype %></td></tr>

        <% if @survey.subtype == "chemical" %>

        <tr><td> pH</td> <td><%= @survey.ph %> </td> </tr>
        <tr><td> Temperature</td> <td> <%= @survey.temperature %></td> </tr>
        <tr><td> Conductivity</td> <td> <%= @survey.conductivity %></td> </tr>
        <tr><td> Nitrogen </td> <td><%= @survey.nitrogen %></td> </tr>
        <tr><td> Phosphorus</td> <td> <%= @survey.phosphorus %></td> </tr>
              
        <% elsif @survey.subtype == "physical" %>

        <tr><td> Width</td> <td><%= @survey.width %> </td> </tr>
        <tr><td> Depth</td> <td> <%= @survey.depth %></td> </tr>
        <tr><td> Manmade_structures</td> <td> <%= @survey.manmade_structures %></td> </tr>
        <tr><td> Flow_regime</td> <td> <%= @survey.flow_regime %></td> </tr>
        <tr><td> Bank_description</td> <td> <%= @survey.bank_description %></td> </tr>
          
        <% elsif @survey.subtype == "biological" %>

        <tr><td>Riparian_description </td> <td> <%= @survey.riparian_description %></td> </tr>
        <tr><td> Abiotic_substrate</td> <td> <%= @survey.abiotic_substrate %> </td> </tr>
        <tr><td>Biotic_substrate</td> <td> <%= @survey.biotic_substrate %></td> </tr>
        <tr><td> Macroinvertebrates</td> <td> <%= @survey. macroinvertebrates%></td> </tr>
           
        <% end %>

        <tr><td>Comments</td><td><%= @survey.comment %></td></tr>

      </tbody>
    </table>
    
    </div>


 </section>
  
<section class="section">
  <%= link_to "View all Surveys", :surveys %>
</section>

</main>

<script>
  <% if @survey.lonlat && @survey.lonlat.coordinates  %>
    var coords = <%= @survey.lonlat.coordinates.to_a.reverse %>;
    var map = L.map('map').setView(coords, 13);
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Map Tiles &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
    map.attributionControl.setPrefix(false);
    L.marker(coords).addTo(map);
  <% end %>

  </script>
